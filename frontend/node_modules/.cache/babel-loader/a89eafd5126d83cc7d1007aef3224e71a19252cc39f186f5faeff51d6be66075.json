{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState } from 'react';\nimport { uploadAudio } from '../services/api';\nconst useUpload = () => {\n  _s();\n  const [uploading, setUploading] = useState(false);\n  const [progress, setProgress] = useState(0);\n  const [result, setResult] = useState(null);\n  const [error, setError] = useState(null);\n\n  // 新增 savePath 參數\n  const upload = async (file, savePath) => {\n    console.log('[useUpload] upload called, file:', file, 'savePath:', savePath);\n    setUploading(true);\n    setProgress(0);\n    setError(null);\n    setResult(null);\n    console.log('[useUpload] 準備上傳檔案:', file, 'size:', file === null || file === void 0 ? void 0 : file.size);\n    try {\n      const response = await uploadAudio(file, savePath, e => {\n        if (e.total) {\n          const prog = Math.round(e.loaded * 100 / e.total);\n          console.log('[useUpload] setProgress:', prog);\n          setProgress(prog);\n        }\n      });\n      console.log('[useUpload] API 回傳 response:', response);\n      if (response && response.data) {\n        console.log('[useUpload] setResult 呼叫, response.data:', response.data);\n        setResult(response.data);\n      } else {\n        console.log('[useUpload] setError 呼叫, response 無 data');\n        setError('API 回傳格式錯誤');\n      }\n    } catch (err) {\n      // 更詳細的錯誤訊息顯示\n      if (err.response) {\n        var _err$response$data;\n        console.log('[useUpload] setError 呼叫, 伺服器錯誤:', err.response);\n        setError(`伺服器錯誤 (${err.response.status}): ` + (((_err$response$data = err.response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.message) || JSON.stringify(err.response.data)));\n      } else if (err.request) {\n        console.log('[useUpload] setError 呼叫, 無法連線到伺服器');\n        setError('無法連線到伺服器，請確認後端 API 是否啟動');\n      } else {\n        console.log('[useUpload] setError 呼叫, 未知錯誤:', err.message);\n        setError('未知錯誤: ' + err.message);\n      }\n    } finally {\n      console.log('[useUpload] setUploading(false)');\n      setUploading(false);\n    }\n  };\n  return {\n    uploading,\n    progress,\n    result,\n    error,\n    upload\n  };\n};\n_s(useUpload, \"42Am1O6PtBgKl7IWzP3lerihfVc=\");\nexport default useUpload;","map":{"version":3,"names":["useState","uploadAudio","useUpload","_s","uploading","setUploading","progress","setProgress","result","setResult","error","setError","upload","file","savePath","console","log","size","response","e","total","prog","Math","round","loaded","data","err","_err$response$data","status","message","JSON","stringify","request"],"sources":["/Users/wenhsu/Documents/my_project/whisper/frontend/src/hooks/useUpload.js"],"sourcesContent":["import { useState } from 'react';\nimport { uploadAudio } from '../services/api';\n\nconst useUpload = () => {\n  const [uploading, setUploading] = useState(false);\n  const [progress, setProgress] = useState(0);\n  const [result, setResult] = useState(null);\n  const [error, setError] = useState(null);\n\n  // 新增 savePath 參數\n  const upload = async (file, savePath) => {\n    console.log('[useUpload] upload called, file:', file, 'savePath:', savePath);\n    setUploading(true);\n    setProgress(0);\n    setError(null);\n    setResult(null);\n    console.log('[useUpload] 準備上傳檔案:', file, 'size:', file?.size);\n    try {\n      const response = await uploadAudio(file, savePath, (e) => {\n        if (e.total) {\n          const prog = Math.round((e.loaded * 100) / e.total);\n          console.log('[useUpload] setProgress:', prog);\n          setProgress(prog);\n        }\n      });\n      console.log('[useUpload] API 回傳 response:', response);\n      if (response && response.data) {\n        console.log('[useUpload] setResult 呼叫, response.data:', response.data);\n        setResult(response.data);\n      } else {\n        console.log('[useUpload] setError 呼叫, response 無 data');\n        setError('API 回傳格式錯誤');\n      }\n    } catch (err) {\n      // 更詳細的錯誤訊息顯示\n      if (err.response) {\n        console.log('[useUpload] setError 呼叫, 伺服器錯誤:', err.response);\n        setError(\n          `伺服器錯誤 (${err.response.status}): ` +\n          (err.response.data?.message || JSON.stringify(err.response.data))\n        );\n      } else if (err.request) {\n        console.log('[useUpload] setError 呼叫, 無法連線到伺服器');\n        setError('無法連線到伺服器，請確認後端 API 是否啟動');\n      } else {\n        console.log('[useUpload] setError 呼叫, 未知錯誤:', err.message);\n        setError('未知錯誤: ' + err.message);\n      }\n    } finally {\n      console.log('[useUpload] setUploading(false)');\n      setUploading(false);\n    }\n  };\n\n  return { uploading, progress, result, error, upload };\n};\n\nexport default useUpload;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}